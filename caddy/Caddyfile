{
  email hello@jackreid.xyz
}

jackreid.xyz {
  encode gzip
  root * /usr/share/caddy/site
  file_server

  log {
    output file /etc/caddy/logs/server_log
  }

  handle_errors {
    rewrite * /{http.error.status_code}.html
    file_server
  }
}

api.jackreid.xyz {
  encode gzip

  route /sync/* {
    uri strip_prefix /sync
    reverse_proxy localhost:8384
  }

  reverse_proxy * http://api:3000 {
    health_path /health
    health_interval 5m
  }

  log {
    output file /etc/caddy/logs/server_log
  }
}

metrics.jackreid.xyz {
  encode gzip

  reverse_proxy * http://127.0.0.1:8384 {
    health_path /
    health_interval 5m
  }

  log {
    output file /etc/caddy/logs/server_log
  }
  errors stderr
}
